<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Redirectingâ€¦</title>
    <script>
      (function () {
        var l = window.location;

        // If we already have ?p=... then DECODE it and go there once.
        if (l.search && l.search.indexOf('?p=') === 0) {
          var target = decodeURIComponent(l.search.slice(3)); // strip "?p="
          // Prevent open redirect: only allow same-origin, path-only targets
          if (target.indexOf('http') === 0) {
            // If someone somehow put a full URL, drop to path-only
            try { target = new URL(target).pathname + new URL(target).search + new URL(target).hash; } catch (e) {}
          }
          l.replace(target || '/');
          return;
        }

        // First time hitting a deep link -> send to root with encoded path once.
        var newUrl =
          l.origin +
          l.pathname.replace(/\/404\.html$/, '') +
          '/?p=' +
          encodeURIComponent(l.pathname + l.search + l.hash);

        l.replace(newUrl);
      })();
    </script>
  </head>
  <body></body>
</html>
